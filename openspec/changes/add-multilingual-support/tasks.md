# 任务清单: 添加多语言支持

## 📋 开发工作流程指导

**重要**: 在处理任何页面、组件或文件时，严格遵循以下工作顺序：

### 🚀 标准开发流程

#### 第一阶段：死代码清理和文件分析
1. **充分理解目标文件**
   - 完整阅读文件代码，理解其功能和结构
   - 识别所有状态变量、函数和组件的使用情况
   - 分析 import 语句和依赖关系

2. **识别和删除死代码**
   - 查找未使用的状态变量（如：只初始化从未修改的useState）
   - 识别未被触发的函数（如：没有调用setShowModal(true)的模态框）
   - 检查条件渲染是否永远不会为真

3. **递归清理依赖文件**
   - 每删除一个import，检查该文件是否在其他地方被使用
   - 如果文件完全未被引用，直接删除文件本身
   - 使用全局搜索确认文件未被其他组件引用

#### 第二阶段：多语言开发（广度优先方式）
4. **处理当前文件的多语言化**
   - 替换所有硬编码的用户可见文本
   - 添加相应的翻译键到语言包
   - 集成useI18n hook和翻译函数

5. **广度优先处理依赖组件**
   - 处理当前文件中import的其他组件/文件
   - 按照同样流程处理：先清理死代码，再多语言化
   - 避免深度递归，采用广度优先策略

### 🔍 死代码识别技巧

#### 常见死代码模式
- **状态变量**: `const [showModal, setShowModal] = useState(false)` + 只有`setShowModal(false)`
- **函数**: 定义了但从无调用的函数
- **条件渲染**: `{showModal && <Modal>}` 但showModal永不为true
- **Import**: 导入但从未使用的组件或函数

#### 验证方法
```bash
# 检查函数/变量是否被使用
grep -r "functionName\|variableName" src/
# 检查import是否被使用
grep -r "ComponentName" src/
# 查找特定模式
grep -rn "setShowModal(true)" src/
```

### ⚠️ 重要提醒
- **每次删除前都要验证**：确保代码确实未被使用
- **保守处理**：不确定是否为死代码时，保留并标记待确认
- **测试验证**：删除后运行应用，确保功能正常
- **语言包同步**：删除死代码时同步移除相关翻译键

### 📈 工作流程优势
- **代码质量提升**：定期清理死代码，保持代码库整洁
- **性能优化**：减少无用代码，降低包大小和内存占用
- **维护性增强**：减少混淆，降低维护成本
- **多语言质量**：确保翻译键只包含实际使用的文本

---

## 里程碑式实施计划

### 里程碑1: 多语言基础环境初始化 (第1次提交)
**预计时间**: 1-2天
**负责人**: 前端开发工程师

#### 1.1 项目初始化
- [x] 创建feature/multilingual-support分支
- [x] 建立i18n目录结构
- [x] 创建TypeScript类型定义文件

#### 1.2 核心服务实现
- [x] 实现i18n.service.ts核心服务
- [x] 创建语言包加载机制
- [x] 实现localStorage缓存策略
- [x] 建立键值对命名规范

#### 1.3 React集成
- [x] 创建I18nProvider组件
- [x] 实现useI18n Hook
- [x] 创建LanguageSelector组件
- [x] 在AppWithRouter.tsx中集成I18nProvider

#### 1.4 基础语言包
- [x] 创建zh-CN.json基础语言包
- [x] 创建en-US.json基础语言包
- [x] 实现语言自动检测逻辑

#### 1.5 验证和测试
- [x] 创建LanguageSelectorDemo组件用于测试
- [x] 验证语言切换基础功能
- [x] 测试错误处理和回退机制

---

### 里程碑2: EntryPage组件多语言化 (第2次提交)
**预计时间**: 2-3天
**负责人**: 前端开发工程师

#### 2.1 文本提取和分析
- [ ] 分析EntryPage.tsx所有硬编码中文文本
- [ ] 创建文本提取清单
- [ ] 设计EntryPage专用的翻译键值对

#### 2.2 翻译工作
- [ ] 创建EntryPage中文键值对
- [ ] 使用AI进行语义化英文翻译
- [ ] 人工校验英文翻译准确性
- [ ] 检查UI文本长度适配性

#### 2.3 组件改造
- [ ] 替换EntryPage硬编码文本为翻译键
- [ ] 集成LanguageSelector到EntryPage
- [ ] 实现动态文本渲染
- [ ] 处理文本长度变化的布局问题

#### 2.4 测试验证
- [ ] 测试EntryPage的语言切换功能
- [ ] 验证所有文本显示正确
- [ ] 测试响应式布局在不同语言下的表现
- [ ] 性能测试和优化

---

### 里程碑3: AuthForm组件多语言化 (第3次提交)
**预计时间**: 2-3天
**负责人**: 前端开发工程师

#### 3.1 认证组件分析
- [ ] 分析AuthForm.tsx所有表单文本
- [ ] 分析EmailStatusModals.tsx相关文本
- [ ] 创建认证相关翻译键值对设计

#### 3.2 表单多语言化
- [ ] 提取所有表单标签和提示文本
- [ ] 翻译表单验证消息
- [ ] 处理邮箱验证相关文本
- [ ] 创建动态错误消息模板

#### 3.3 组件实现
- [ ] 修改AuthForm组件支持多语言
- [ ] 修改EmailStatusModals组件
- [ ] 实现表单字段的多语言标签
- [ ] 处理按钮和链接文本

#### 3.4 功能测试
- [ ] 测试表单多语言切换
- [ ] 验证表单验证消息多语言显示
- [ ] 测试邮箱验证流程的多语言支持
- [ ] 用户体验测试

---

### 里程碑4: RoomPage主页面多语言化 (第4次提交)
**预计时间**: 3-4天
**负责人**: 前端开发工程师

#### 4.1 大型组件分析
- [ ] 分析RoomPage.tsx (944行代码) 所有UI文本
- [ ] 识别角色分类文本(辅助/打野/对线)
- [ ] 分析操作按钮和状态提示
- [ ] 分析模态框组件文本

#### 4.2 核心功能多语言化
- [ ] 翻译角色分类文本
- [ ] 翻译操作按钮和状态提示
- [ ] 处理动态计数文本模板
- [ ] 翻译帮助信息和提示文本

#### 4.3 模态框组件改造
- [ ] 修改SelectedHeroesModal组件
- [ ] 修改ResetConfirmModal组件
- [ ] 处理其他相关模态框
- [ ] 实现模态框内容的动态切换

#### 4.4 复杂功能测试
- [ ] 测试完整的多语言游戏体验
- [ ] 验证动态文本显示正确
- [ ] 测试复杂交互的多语言支持
- [ ] 性能基准测试

---

### 里程碑5: RoomsPage房间列表多语言化 (第5次提交)
**预计时间**: 2-3天
**负责人**: 前端开发工程师

#### 5.1 房间管理分析
- [ ] 分析RoomsPage.tsx所有文本
- [ ] 分析RoomFormModal.tsx表单文本
- [ ] 分析FilterHeader.tsx筛选界面
- [ ] 创建房间管理相关翻译键

#### 5.2 房间功能多语言化
- [ ] 翻译房间创建/编辑表单
- [ ] 翻译房间筛选和排序选项
- [ ] 处理房间状态显示文本
- [ ] 翻译房间列表相关文本

#### 5.3 组件实现
- [ ] 修改RoomsPage主组件
- [ ] 修改RoomFormModal表单组件
- [ ] 修改FilterHeader筛选组件
- [ ] 处理房间卡片显示文本

#### 5.4 流程测试
- [ ] 测试房间创建流程多语言
- [ ] 测试房间筛选和搜索
- [ ] 验证房间状态显示
- [ ] 端到端流程测试

---

### 里程碑6: 英雄数据和HeroCard多语言化 (第6次提交)
**预计时间**: 2-3天
**负责人**: 前端开发工程师

#### 6.1 英雄数据结构扩展
- [ ] 扩展Hero类型定义支持本地化
- [ ] 创建英雄本地化数据结构
- [ ] 设计英雄昵称处理策略
- [ ] 创建heroLocalization.service.ts

#### 6.2 英雄本地化数据
- [ ] 提取所有英雄的中文昵称
- [ ] 创建中文英雄本地化文件(zh-CN.json)
- [ ] 创建英文英雄本地化文件(en-US.json)
- [ ] 实现昵称显示逻辑

#### 6.3 HeroCard组件改造
- [ ] 修改HeroCard.tsx显示逻辑
- [ ] 实现中英文环境昵称显示切换
- [ ] 优化英雄名称显示格式
- [ ] 处理ClassificationToggle组件

#### 6.4 英雄显示测试
- [ ] 测试英雄显示的多语言切换
- [ ] 验证中文环境昵称显示
- [ ] 测试英文环境昵称隐藏
- [ ] 验证英雄搜索功能兼容性

---

### 里程碑7: 搜索功能多语言化 (第7次提交)
**预计时间**: 2-3天
**负责人**: 前端开发工程师

#### 7.1 搜索算法分析
- [ ] 分析现有搜索算法架构
- [ ] 识别多语言搜索需求
- [ ] 设计多语言搜索策略
- [ ] 创建multilingualSearch.service.ts

#### 7.2 搜索功能增强
- [ ] 实现中英文混合搜索
- [ ] 优化中文拼音搜索算法
- [ ] 增强英文模糊匹配功能
- [ ] 实现搜索结果智能排序

#### 7.3 搜索体验优化
- [ ] 实现搜索关键词高亮
- [ ] 优化搜索性能和响应速度
- [ ] 实现搜索历史多语言支持
- [ ] 添加搜索建议功能

#### 7.4 搜索功能测试
- [ ] 测试中英混合搜索功能
- [ ] 验证搜索结果准确性
- [ ] 测试搜索性能基准
- [ ] 用户体验测试

---

### 里程碑8: 最终优化和测试 (第8次提交)
**预计时间**: 2-3天
**负责人**: 前端开发工程师

#### 8.1 性能优化
- [ ] 分析应用启动时间影响
- [ ] 优化语言包加载性能
- [ ] 实现预加载机制
- [ ] 内存使用优化

#### 8.2 全面测试
- [ ] 完整的多语言功能测试
- [ ] UI布局适配性检查
- [ ] 浏览器兼容性测试
- [ ] 移动端响应式测试

#### 8.3 用户体验优化
- [ ] 语言切换动画优化
- [ ] 错误处理用户体验改进
- [ ] 无障碍访问支持
- [ ] 加载状态优化

#### 8.4 文档和交付
- [ ] 更新项目文档
- [ ] 创建用户使用指南
- [ ] 创建开发者文档
- [ ] OpenSpec变更文档验证

---

## 依赖关系

### 前置依赖
- OpenSpec变更创建和批准
- feature/multilingual-support分支创建
- 开发环境准备

### 里程碑依赖
- 里程碑2-8依赖里程碑1的基础环境
- 里程碑6依赖里程碑2-5的UI文本多语言化
- 里程碑7依赖里程碑6的英雄数据多语言化
- 里程碑8依赖所有前置里程碑

### 外部依赖
- 现有的add-supabase-realtime-rooms变更
- 项目现有的组件架构
- Vite构建工具配置

## 风险缓解

### 技术风险
- **文本工作量过大**: 采用AI辅助翻译，分阶段实施
- **UI布局问题**: 使用弹性布局，早期测试验证
- **性能影响**: 实施懒加载和缓存策略

### 进度风险
- **时间估算偏差**: 预留20%缓冲时间
- **技术难点**: 预先研究和验证关键技术点
- **集成问题**: 每个里程碑独立测试验证

### 质量风险
- **翻译质量**: AI翻译+人工校验双重保障
- **功能遗漏**: 详细的需求分析和测试用例
- **兼容性问题**: 全面的浏览器和设备测试

## 成功标准

### 功能完整性
- [ ] 所有页面支持中英文切换
- [ ] 英雄数据显示正确
- [ ] 搜索功能保持优势
- [ ] 用户偏好持久化

### 性能指标
- [ ] 应用启动时间增加<10%
- [ ] 语言切换响应时间<200ms
- [ ] 搜索性能保持现有水平
- [ ] 内存使用增加<5MB

### 用户体验
- [ ] 中文用户使用体验无影响
- [ ] 英文用户可以正常使用
- [ ] 语言切换操作直观
- [ ] 界面布局美观协调

---

**任务清单版本**: 1.0
**创建时间**: 2025-12-04
**最后更新**: 2025-12-04
**预计总工时**: 15-20工作日
**负责人**: Claude AI Assistant