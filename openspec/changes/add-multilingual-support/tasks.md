# 任务清单: 添加多语言支持

## 📋 开发工作流程指导

**重要**: 在处理任何页面、组件或文件时，严格遵循以下工作顺序：

### 🚀 标准开发流程

#### 第一阶段：死代码清理和文件分析

1. **充分理解目标文件**
   - 完整阅读文件代码，理解其功能和结构
   - 识别所有状态变量、函数和组件的使用情况
   - 分析 import 语句和依赖关系

2. **识别和删除死代码**
   - 查找未使用的状态变量（如：只初始化从未修改的useState）
   - 识别未被触发的函数（如：没有调用setShowModal(true)的模态框）
   - 检查条件渲染是否永远不会为真

3. **递归清理依赖文件**
   - 每删除一个import，检查该文件是否在其他地方被使用
   - 如果文件完全未被引用，直接删除文件本身
   - 使用全局搜索确认文件未被其他组件引用

#### 第二阶段：多语言开发（广度优先方式）

4. **处理当前文件的多语言化**
   - 替换所有硬编码的用户可见文本
   - 添加相应的翻译键到语言包
   - 集成useI18n hook和翻译函数

5. **广度优先处理依赖组件**
   - 处理当前文件中import的其他组件/文件
   - 按照同样流程处理：先清理死代码，再多语言化
   - 避免深度递归，采用广度优先策略

### 🔍 死代码识别技巧

#### 常见死代码模式

- **状态变量**: `const [showModal, setShowModal] = useState(false)` + 只有`setShowModal(false)`
- **函数**: 定义了但从无调用的函数
- **条件渲染**: `{showModal && <Modal>}` 但showModal永不为true
- **Import**: 导入但从未使用的组件或函数

#### 验证方法

```bash
# 检查函数/变量是否被使用
grep -r "functionName\|variableName" src/
# 检查import是否被使用
grep -r "ComponentName" src/
# 查找特定模式
grep -rn "setShowModal(true)" src/
```

### ⚠️ 重要提醒

- **每次删除前都要验证**：确保代码确实未被使用
- **保守处理**：不确定是否为死代码时，保留并标记待确认
- **测试验证**：删除后运行应用，确保功能正常
- **语言包同步**：删除死代码时同步移除相关翻译键

### 📈 工作流程优势

- **代码质量提升**：定期清理死代码，保持代码库整洁
- **性能优化**：减少无用代码，降低包大小和内存占用
- **维护性增强**：减少混淆，降低维护成本
- **多语言质量**：确保翻译键只包含实际使用的文本

---

## 里程碑式实施计划

### 里程碑1: 多语言基础环境初始化 (第1次提交)

**预计时间**: 1-2天
**负责人**: 前端开发工程师

#### 1.1 项目初始化

- [x] 创建feature/multilingual-support分支
- [x] 建立i18n目录结构
- [x] 创建TypeScript类型定义文件

#### 1.2 核心服务实现

- [x] 实现i18n.service.ts核心服务
- [x] 创建语言包加载机制
- [x] 实现localStorage缓存策略
- [x] 建立键值对命名规范

#### 1.3 React集成

- [x] 创建I18nProvider组件
- [x] 实现useI18n Hook
- [x] 创建LanguageSelector组件
- [x] 在AppWithRouter.tsx中集成I18nProvider

#### 1.4 基础语言包

- [x] 创建zh-CN.json基础语言包
- [x] 创建en-US.json基础语言包
- [x] 实现语言自动检测逻辑

#### 1.5 验证和测试

- [x] 创建LanguageSelectorDemo组件用于测试
- [x] 验证语言切换基础功能
- [x] 测试错误处理和回退机制

---

### 里程碑2: EntryPage组件多语言化 (第2次提交)

**预计时间**: 2-3天
**负责人**: 前端开发工程师

#### 2.1 文本提取和分析

- [x] 分析EntryPage.tsx所有硬编码中文文本
- [x] 创建文本提取清单
- [x] 设计EntryPage专用的翻译键值对

#### 2.2 翻译工作

- [x] 创建EntryPage中文键值对
- [x] 使用AI进行语义化英文翻译
- [x] 人工校验英文翻译准确性
- [x] 检查UI文本长度适配性

#### 2.3 组件改造

- [x] 替换EntryPage硬编码文本为翻译键
- [x] 集成LanguageSelector到EntryPage
- [x] 实现动态文本渲染
- [x] 处理文本长度变化的布局问题

#### 2.4 测试验证

- [x] 测试EntryPage的语言切换功能
- [x] 验证所有文本显示正确
- [x] 测试响应式布局在不同语言下的表现
- [x] 性能测试和优化

---

### 里程碑3: RoomsPage房间列表多语言化 (第3次提交)

**预计时间**: 3-4天
**负责人**: 前端开发工程师

#### 3.1 房间列表页面分析

- [x] 分析RoomsPage.tsx结构（简单包装组件）
- [x] 分析RoomManager.tsx (459行) 所有硬编码中文文本
- [x] 分析FilterHeader.tsx筛选界面文本
- [x] 分析RoomItem.tsx房间项显示文本
- [x] 分析RoomHeader.tsx头部组件文本
- [x] 分析Pagination.tsx分页组件文本
- [x] 创建房间管理相关翻译键值对设计

#### 3.2 认证组件多语言化（原里程碑3内容）

- [x] 分析AuthForm.tsx所有表单文本
- [x] 分析EmailStatusModals.tsx相关文本
- [x] 提取所有表单标签和提示文本
- [x] 翻译表单验证消息
- [x] 处理邮箱验证相关文本
- [x] 创建动态错误消息模板

#### 3.3 房间管理核心组件文本提取

- [x] 提取RoomSearchBox.tsx搜索框文本
- [x] 提取RoomSortToggle.tsx排序选项文本
- [x] 提取OwnerToggle.tsx筛选选项文本
- [x] 提取FilterChips.tsx筛选标签文本
- [x] 提取房间状态和操作相关文本

#### 3.4 房间列表功能多语言化

- [x] 翻译房间列表显示文本
- [x] 翻译筛选和排序选项
- [x] 翻译房间状态和标签
- [x] 翻译分页控件文本
- [x] 翻译搜索提示和占位符文本
- [x] 处理动态计数和提示文本模板

#### 3.5 组件实现

- [x] 修改RoomsPage主组件支持多语言（简单组件）
- [x] 修改RoomManager房间管理器组件
- [x] 修改FilterHeader筛选组件
- [x] 修改RoomItem房间项组件
- [x] 修改RoomHeader头部组件
- [x] 修改RoomSearchBox搜索框组件
- [x] 修改RoomSortToggle排序组件
- [x] 修改OwnerToggle筛选组件
- [x] 修改FilterChips筛选标签组件
- [x] 修改Pagination分页组件
- [x] 修改AuthForm组件支持多语言
- [x] 修改EmailStatusModals组件
- [x] 实现表单字段的多语言标签
- [x] 处理按钮和链接文本

#### 3.6 功能测试

- [x] 测试房间列表页面语言切换
- [x] 测试筛选和排序功能多语言
- [x] 测试搜索功能多语言
- [x] 测试表单多语言切换
- [x] 验证表单验证消息多语言显示
- [x] 测试邮箱验证流程的多语言支持
- [x] 测试房间列表响应式布局多语言
- [x] 用户体验测试

#### 3.7 添加房间列表页面的语言切换功能

- [x] 分析RoomHeader.tsx组件结构，确定语言切换器位置
- [x] 分析现有的LanguageSelector组件实现
- [x] 设计语言切换器在房间列表页面的布局和样式
- [x] 优化LanguageSelector组件的UI设计，提升用户体验
- [x] 将语言切换器集成到RoomHeader组件中
- [x] 确保语言切换器在移动端和桌面端都有良好的显示效果
- [x] 测试语言切换功能的实时性和准确性

---

### 里程碑4: 房间相关模态框多语言化 (第4次提交)

**预计时间**: 2-3天
**负责人**: 前端开发工程师

#### 4.1 模态框组件分析

- [x] 分析RoomFormModal.tsx创建/编辑房间表单
- [x] 分析JoinRoomModal.tsx加入房间表单
- [x] 分析UserSettingsModal.tsx用户设置表单
- [x] 分析DeleteConfirmModal.tsx删除确认
- [x] 分析RoomManagerMenuModal.tsx移动端菜单
- [x] 分析AuthModal.tsx认证模态框

#### 4.2 模态框功能多语言化

- [x] 翻译房间创建/编辑表单文本
- [x] 翻译加入房间相关文本
- [x] 翻译用户设置选项
- [x] 翻译确认对话框文本
- [x] 翻译移动端菜单项
- [x] 翻译认证相关文本

#### 4.3 组件实现

- [x] 修改RoomFormModal组件
- [x] 修改JoinRoomModal组件
- [x] 修改UserSettingsModal组件
- [x] 修改DeleteConfirmModal组件
- [x] 修改RoomManagerMenuModal组件
- [x] 修改AuthModal组件

#### 4.4 功能测试

- [x] 测试所有模态框的语言切换
- [x] 测试房间创建流程多语言
- [x] 测试用户设置多语言
- [x] 测试删除确认多语言
- [x] 测试认证流程多语言

---

### 里程碑5: RoomPage主页面多语言化 (第5次提交)

**预计时间**: 3-4天
**负责人**: 前端开发工程师

#### 5.1 大型组件分析

- [x] 分析RoomPage.tsx (944行代码) 所有UI文本
- [x] 识别角色分类文本(辅助/打野/对线)
- [x] 分析操作按钮和状态提示
- [x] 分析模态框组件文本

#### 5.2 核心功能多语言化

- [x] 在语言包中添加 RoomPage 相关的翻译键
- [x] 替换 RoomPage.tsx 中的硬编码文本为翻译函数调用
- [x] 处理动态计数文本模板
- [x] 翻译帮助信息和提示文本

#### 5.3 模态框组件改造

- [x] 修改SelectedHeroesModal组件
- [x] 修改ResetConfirmModal组件
- [x] 修改ClassificationInfoModal组件
- [x] 修改ClassificationToggle组件
- [x] 修改RealtimeStatus组件
- [x] 修改PermissionIndicator组件
- [x] 实现模态框内容的动态切换

#### 5.4 复杂功能测试

- [x] 测试完整的多语言游戏体验
- [x] 验证动态文本显示正确
- [x] 测试复杂交互的多语言支持
- [x] 性能基准测试

---

### 里程碑6: 英雄数据和HeroCard多语言化 (第6次提交)

**预计时间**: 2-3天
**负责人**: 前端开发工程师

#### 6.1 英雄数据结构扩展

- [x] ~~扩展Hero类型定义支持本地化~~ (使用现有Hero类型)
- [x] ~~创建英雄本地化数据结构~~ (直接使用hero数据字段)
- [x] 设计英雄昵称处理策略
- [x] ~~创建heroLocalization.service.ts~~ (直接在组件内实现)

#### 6.2 英雄本地化数据

- [x] ~~提取所有英雄的中文昵称~~ (使用现有数据)
- [x] ~~创建中文英雄本地化文件(zh-CN.json)~~ (使用现有数据)
- [x] ~~创建英文英雄本地化文件(en-US.json)~~ (使用现有数据)
- [x] 实现昵称显示逻辑

#### 6.3 HeroCard组件改造

- [x] 修改HeroCard.tsx显示逻辑
- [x] 实现中英文环境昵称显示切换
- [x] 优化英雄名称显示格式
- [x] 处理ClassificationToggle组件

#### 6.4 英雄显示测试

- [x] 测试英雄显示的多语言切换
- [x] 验证中文环境昵称显示
- [x] 测试英文环境昵称隐藏
- [x] 验证英雄搜索功能兼容性

---

### 里程碑7: 搜索功能多语言化 (第7次提交)

**预计时间**: 2-3天
**负责人**: 前端开发工程师

#### 7.1 搜索算法分析

- [x] 分析现有搜索算法架构
- [x] 识别多语言搜索需求
- [x] 设计多语言搜索策略
- [x] 创建multilingualSearch.service.ts

#### 7.2 搜索功能增强

- [x] 实现中英文混合搜索
- [x] 优化中文拼音搜索算法
- [x] 增强英文模糊匹配功能
- [x] 实现搜索结果智能排序

#### 7.3 搜索体验优化

- [x] 实现搜索关键词高亮
- [x] 优化搜索性能和响应速度
- [x] 实现搜索历史多语言支持
- [x] 添加搜索建议功能

#### 7.4 搜索功能测试

- [x] 测试中英混合搜索功能
- [x] 验证搜索结果准确性
- [x] 测试搜索性能基准
- [x] 用户体验测试

---

### 里程碑8: Supabase API和邮件国际化 (第8次提交)

**预计时间**: 2-3天
**负责人**: 前端开发工程师

#### 8.1 Supabase错误消息国际化

- [ ] 分析现有Supabase API错误消息
- [ ] 创建错误消息翻译映射表
- [ ] 实现translateSupabaseError服务
- [ ] 集成到现有的错误处理流程
- [ ] 测试所有认证相关错误的本地化

#### 8.2 Edge Function邮件国际化

- [ ] 分析现有Edge Function邮件模板
  - [ ] send-confirmation 确认邮件
  - [ ] resend-confirmation 重新发送确认邮件
  - [ ] check-email 邮箱检查通知
- [ ] 创建多语言邮件模板系统
- [ ] 实现邮件内容本地化选择逻辑
- [ ] 支持用户偏好语言检测
- [ ] 集成到现有邮件发送流程

#### 8.3 Supabase Auth邮件国际化

- [ ] 研究Supabase Auth邮件模板自定义
- [ ] 创建自定义邮件模板
- [ ] 实现邮件内容动态语言选择
- [ ] 配置Supabase项目设置支持多语言
- [ ] 测试认证流程的多语言邮件

#### 8.4 API响应消息本地化

- [ ] 创建统一的API错误处理中间件
- [ ] 实现服务端错误消息翻译
- [ ] 集成到现有的API调用流程
- [ ] 处理数据库层面的错误消息
- [ ] 确保错误日志保持原始英文信息

#### 8.5 邮件模板设计

- [ ] 设计中英文邮件模板样式
- [ ] 实现邮件模板响应式布局
- [ ] 添加品牌元素和统一风格
- [ ] 创建邮件模板管理系统
- [ ] 支持动态内容插入

#### 8.6 测试和验证

- [ ] 测试Supabase错误消息本地化
- [ ] 验证所有Edge Function邮件多语言
- [ ] 测试认证流程的邮件本地化
- [ ] 验证API响应消息翻译
- [ ] 用户体验测试和反馈收集

---

### 里程碑9: 最终优化和测试 (第9次提交)

**预计时间**: 2-3天
**负责人**: 前端开发工程师

#### 8.1 性能优化

- [ ] 分析应用启动时间影响
- [ ] 优化语言包加载性能
- [ ] 实现预加载机制
- [ ] 内存使用优化

#### 8.2 全面测试

- [ ] 完整的多语言功能测试
- [ ] UI布局适配性检查
- [ ] 浏览器兼容性测试
- [ ] 移动端响应式测试

#### 8.3 用户体验优化

- [ ] 语言切换动画优化
- [ ] 错误处理用户体验改进
- [ ] 无障碍访问支持
- [ ] 加载状态优化

#### 8.4 文档和交付

- [ ] 更新项目文档
- [ ] 创建用户使用指南
- [ ] 创建开发者文档
- [ ] OpenSpec变更文档验证

---

## 依赖关系

### 前置依赖

- OpenSpec变更创建和批准
- feature/multilingual-support分支创建
- 开发环境准备

### 里程碑依赖

- 里程碑2-9依赖里程碑1的基础环境
- 里程碑6依赖里程碑2-5的UI文本多语言化
- 里程碑7依赖里程碑6的英雄数据多语言化
- 里程碑8依赖里程碑1-7（低优先级，可独立实施）
- 里程碑9依赖里程碑1-8

### 外部依赖

- 现有的add-supabase-realtime-rooms变更
- 项目现有的组件架构
- Vite构建工具配置

## 风险缓解

### 技术风险

- **文本工作量过大**: 采用AI辅助翻译，分阶段实施
- **UI布局问题**: 使用弹性布局，早期测试验证
- **性能影响**: 实施懒加载和缓存策略

### 进度风险

- **时间估算偏差**: 预留20%缓冲时间
- **技术难点**: 预先研究和验证关键技术点
- **集成问题**: 每个里程碑独立测试验证

### 质量风险

- **翻译质量**: AI翻译+人工校验双重保障
- **功能遗漏**: 详细的需求分析和测试用例
- **兼容性问题**: 全面的浏览器和设备测试

## 成功标准

### 功能完整性

- [ ] 所有页面支持中英文切换
- [ ] 英雄数据显示正确
- [ ] 搜索功能保持优势
- [ ] 用户偏好持久化
- [ ] Supabase错误消息本地化显示
- [ ] 所有邮件支持用户偏好语言

### 性能指标

- [ ] 应用启动时间增加<10%
- [ ] 语言切换响应时间<200ms
- [ ] 搜索性能保持现有水平
- [ ] 内存使用增加<5MB

### 用户体验

- [ ] 中文用户使用体验无影响
- [ ] 英文用户可以正常使用
- [ ] 语言切换操作直观
- [ ] 界面布局美观协调

---

**任务清单版本**: 1.1
**创建时间**: 2025-12-04
**最后更新**: 2025-12-04
**预计总工时**: 18-23工作日
**负责人**: Claude AI Assistant

**重要更新**:
- 添加里程碑8: Supabase API和邮件国际化（低优先级）
- 确认现有Edge Function邮件模板国际化需求
- 将原里程碑8重命名为里程碑9

